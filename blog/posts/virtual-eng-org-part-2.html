<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giving Each Agent a Desk â€” Persistent Identities and Workspaces | The Virtual Engineering Org â€” James H. Nguyen</title>
    <meta name="description" content="Phase 2: From ephemeral sub-agents to a permanent engineering team. How we gave AI agents their own workspaces, identities, memory, and communication channels â€” and what changed when they remembered.">
    <meta name="author" content="James H. Nguyen">

    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Giving Each Agent a Desk â€” Persistent Identities and Workspaces">
    <meta property="og:description" content="Phase 2 of 3: How we went from ephemeral sub-agents to a permanent AI engineering team with identity, memory, and channel routing.">
    <meta property="og:image" content="https://ipv1337.dev/images/virtual-eng-org-part-2.jpg">
    <meta property="og:url" content="https://ipv1337.dev/blog/posts/virtual-eng-org-part-2.html">
    <meta property="article:published_time" content="2026-02-21">
    <meta property="article:author" content="James H. Nguyen">
    <meta property="article:tag" content="OpenClaw">
    <meta property="article:tag" content="AI Agents">
    <meta property="article:tag" content="Multi-Agent">
    <meta property="article:tag" content="workspaces">
    <meta property="article:tag" content="identity">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@ipv1337">
    <meta name="twitter:title" content="Giving Each Agent a Desk â€” Persistent Identities and Workspaces">
    <meta name="twitter:description" content="Phase 2 of 3: How we went from ephemeral sub-agents to a permanent AI engineering team with identity, memory, and channel routing.">
    <meta name="twitter:image" content="https://ipv1337.dev/images/virtual-eng-org-part-2.jpg">

    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="canonical" href="https://ipv1337.dev/blog/posts/virtual-eng-org-part-2.html">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Highlight.js for code -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">

    <link rel="stylesheet" href="/blog/blog.css">
    <link rel="stylesheet" href="/blog/post.css">
    <link rel="stylesheet" href="/blog/series.css">
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-gradient"></div>

    <div class="reading-progress" id="readingProgress"></div>

    <header>
        <nav class="container">
            <a href="/" class="nav-brand">
                <span class="brand-icon">JN</span>
                <span>James H. Nguyen</span>
            </a>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/blog/" class="active">Blog</a></li>
                <li><a href="/#projects">Projects</a></li>
                <li><a href="/#connect">Connect</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <article class="post">
            <div class="post-header">
                <div class="container">
                    <a href="/blog/" class="back-link"><i class="fas fa-arrow-left"></i> Back to Blog</a>
                    <div class="series-badge">
                        <span class="series-badge-icon">âš¡</span>
                        <span>Part 2 of 3 â€” The Virtual Engineering Org</span>
                    </div>
                    <div class="post-meta">
                        <span class="post-category">AI Agents</span>
                        <span class="post-date">February 21, 2026</span>
                        <span class="post-read-time"><i class="far fa-clock"></i> 11 min read</span>
                    </div>
                    <h1>Giving Each Agent a Desk â€” Persistent Identities and Workspaces</h1>
                    <p class="post-subtitle">
                        Giving AI agents identity, memory, and a place to work. How we went from
                        ephemeral sub-agents to a permanent engineering team â€” and what changed
                        when they started remembering.
                    </p>
                    <div class="post-tags">
                        <span class="tag">OpenClaw</span>
                        <span class="tag">AI Agents</span>
                        <span class="tag">Multi-Agent</span>
                        <span class="tag">workspaces</span>
                        <span class="tag">identity</span>
                    </div>
                </div>
            </div>

            <div class="post-hero">
                <img src="/images/virtual-eng-org-part-2.jpg" alt="Giving Each Agent a Desk â€” Phase 2 of the Virtual Engineering Org">
            </div>

            <div class="post-content">
                <div class="container">

                    <!-- Series Banner -->
                    <div class="series-banner">
                        <div class="series-banner-left">
                            <span class="series-banner-number">2</span>
                            <div class="series-banner-info">
                                <span class="series-banner-label">Part 2 of 3</span>
                                <span class="series-banner-title"><a href="/blog/virtual-eng-org/">The Virtual Engineering Org</a></span>
                            </div>
                        </div>
                        <div class="series-banner-dots">
                            <span class="series-dot completed"></span>
                            <span class="series-dot active"></span>
                            <span class="series-dot"></span>
                        </div>
                    </div>

                    <!-- Meta Callout -->
                    <div class="meta-badge">
                        <div class="meta-badge-icon">ğŸ”„</div>
                        <div class="meta-badge-content">
                            <strong>Meta:</strong> This post was produced by the system it describes.
                            A persistent Analyst agent researched the outline â€” using memory from its
                            Part 1 research. A persistent Architect agent reviewed it, referencing its
                            own prior technical corrections. A persistent Tech Writer agent drafted
                            these words, drawing on the voice it developed across the series. The
                            difference from Part 1? This time, they all remembered.
                        </div>
                    </div>

                    <!-- === THE IDEA === -->
                    <section>
                        <h2>The Idea: Our Agents Had Amnesia</h2>

                        <p>
                            Our Analyst kept re-discovering the same things. Our Architect forgot
                            its own decisions. Something had to change.
                        </p>
                        <p>
                            In <a href="/blog/posts/virtual-eng-org-part-1.html">Part 1</a>, we
                            taught the Lead agent to delegate. It could spawn an Analyst to research,
                            an Architect to review, a Writer to draft â€” all in parallel, all in
                            isolated sessions. The fan-out/fan-in pattern worked. Sub-agents produced
                            real output. The pipeline that created this very blog series proved the
                            concept.
                        </p>
                        <p>
                            But every spawn started cold. The Analyst couldn't reference last week's
                            research notes. The Architect couldn't consult its own prior technical
                            decisions. Every sub-agent was a stranger who happened to be good at
                            their job â€” but had never worked here before.
                        </p>
                        <p>
                            And there was the identity gap. Remember the key insight from Part 1:
                            sub-agents only receive <code>AGENTS.md</code> and <code>TOOLS.md</code>.
                            No <code>SOUL.md</code>. No <code>IDENTITY.md</code>. No
                            <code>USER.md</code>. We couldn't give the Architect a persona that
                            shaped how it reasoned about trade-offs. We couldn't give the Writer a
                            voice that persisted across drafts. Sub-agents had skills but no character.
                        </p>
                        <p>
                            The organizational analogy made this clear: you don't hire a new
                            contractor for every task. At some point, you build a team. You give each
                            person a desk, a title, and access to the institutional knowledge they
                            need to do their job well. That's what Phase 2 is â€” the leap from temps
                            to full-time hires.
                        </p>
                    </section>

                    <!-- === THE BUILD === -->
                    <section>
                        <h2>The Build: Declaring the Team Roster</h2>

                        <h3>What a "Persistent Agent" Actually Is</h3>

                        <p>
                            In OpenClaw, a persistent agent isn't a separate process or a new
                            deployment. It's a declaration in your
                            <a href="https://docs.openclaw.ai/concepts/multi-agent"><code>openclaw.json</code></a>
                            that says: <em>this identity exists, and here's where it lives.</em> Each
                            agent gets:
                        </p>
                        <ul>
                            <li><strong>Its own workspace</strong> â€” a directory with <code>AGENTS.md</code>, <code>SOUL.md</code>, <code>IDENTITY.md</code>, <code>USER.md</code>, and a <code>memory/</code> folder. This is the agent's desk.</li>
                            <li><strong>Its own state directory</strong> (<code>agentDir</code>) â€” isolated auth profiles, session store, and conversation history. This is the agent's filing cabinet.</li>
                            <li><strong>Its own session store</strong> â€” conversation history that persists across interactions. The agent remembers what you talked about.</li>
                            <li><strong>Its own skills folder</strong> â€” specialized capabilities loaded per-agent.</li>
                        </ul>
                        <p>
                            The session key structure makes this traceable. The Lead's main session
                            is <code>agent:lead:main</code>. When the Lead spawns a sub-agent, that
                            sub-agent's session is <code>agent:lead:subagent:&lt;uuid&gt;</code>. But
                            a persistent Architect agent has its own main session:
                            <code>agent:architect:main</code>. It's not the Lead wearing a hat â€” it's
                            a separate entity with its own memory.
                        </p>

                        <h3>The Config: <code>agents.list[]</code></h3>

                        <p>
                            Here's the diff from our Phase 1 config to Phase 2. This is the
                            single change that transforms a solo agent into a team:
                        </p>

                        <div class="diff-block">
                            <div class="diff-header">
                                <span class="diff-filename">openclaw.json</span>
                                <div class="diff-labels">
                                    <span class="diff-label-old">Phase 1</span>
                                    <span>â†’</span>
                                    <span class="diff-label-new">Phase 2</span>
                                </div>
                            </div>
                            <pre><code><span class="diff-context">  agents: {</span>
<span class="diff-remove">-   // Single agent mode â€” no agent list</span>
<span class="diff-remove">-   // Sub-agents spawned on demand via sessions_spawn</span>
<span class="diff-add">+   list: [</span>
<span class="diff-add">+     {</span>
<span class="diff-add">+       id: "lead",</span>
<span class="diff-add">+       default: true,</span>
<span class="diff-add">+       name: "Lead Engineer",</span>
<span class="diff-add">+       workspace: "~/.openclaw/workspace-lead",</span>
<span class="diff-add">+       model: "anthropic/claude-opus-4-6",</span>
<span class="diff-add">+     },</span>
<span class="diff-add">+     {</span>
<span class="diff-add">+       id: "analyst",</span>
<span class="diff-add">+       name: "Analyst",</span>
<span class="diff-add">+       workspace: "~/.openclaw/workspace-analyst",</span>
<span class="diff-add">+       model: "anthropic/claude-sonnet-4-5",</span>
<span class="diff-add">+       identity: { name: "Analyst" },</span>
<span class="diff-add">+     },</span>
<span class="diff-add">+     {</span>
<span class="diff-add">+       id: "architect",</span>
<span class="diff-add">+       name: "Architect",</span>
<span class="diff-add">+       workspace: "~/.openclaw/workspace-architect",</span>
<span class="diff-add">+       model: "anthropic/claude-opus-4-6",</span>
<span class="diff-add">+       identity: { name: "Architect" },</span>
<span class="diff-add">+     },</span>
<span class="diff-add">+     {</span>
<span class="diff-add">+       id: "writer",</span>
<span class="diff-add">+       name: "Tech Writer",</span>
<span class="diff-add">+       workspace: "~/.openclaw/workspace-writer",</span>
<span class="diff-add">+       model: "anthropic/claude-sonnet-4-5",</span>
<span class="diff-add">+       identity: { name: "Tech Writer" },</span>
<span class="diff-add">+     },</span>
<span class="diff-add">+     {</span>
<span class="diff-add">+       id: "devops",</span>
<span class="diff-add">+       name: "DevOps / QA",</span>
<span class="diff-add">+       workspace: "~/.openclaw/workspace-devops",</span>
<span class="diff-add">+       model: "anthropic/claude-sonnet-4-5",</span>
<span class="diff-add">+       identity: { name: "DevOps" },</span>
<span class="diff-add">+     },</span>
<span class="diff-add">+   ],</span>
<span class="diff-context">    defaults: {</span>
<span class="diff-context">      subagents: {</span>
<span class="diff-context">        model: "anthropic/claude-sonnet-4-5",</span>
<span class="diff-context">        maxConcurrent: 8,</span>
<span class="diff-context">      }</span>
<span class="diff-context">    }</span>
<span class="diff-context">  }</span></code></pre>
                        </div>

                        <p>
                            Five agents. Five workspaces. Each with its own model selection,
                            identity, and place to store what it learns. The <code>default: true</code>
                            on the Lead means unrouted messages still go to it â€” the Lead remains the
                            front door.
                        </p>

                        <div class="callout try-it">
                            <div class="callout-header">
                                <i class="fas fa-terminal"></i> Try it yourself
                            </div>
                            <div class="callout-body">
                                <p>You don't have to hand-edit <code>openclaw.json</code>. The
                                <code>openclaw agents add</code> wizard walks you through creating a
                                new agent interactively â€” workspace path, model, identity, and
                                bindings:</p>
<pre><code class="language-bash">openclaw agents add architect</code></pre>
                                <p>It creates the workspace directory and scaffolds the config entry.
                                You then add your <code>AGENTS.md</code>, <code>SOUL.md</code>, and
                                <code>IDENTITY.md</code> to shape the agent's persona. Start with one
                                agent beyond the default and expand from there.</p>
                            </div>
                        </div>
                    </section>

                    <!-- === Identity and Persona === -->
                    <section>
                        <h2>Identity and Persona: Why <code>SOUL.md</code> Matters</h2>

                        <p>
                            Here's the thing we didn't expect: persona isn't cosmetic. It shapes
                            behavior. When a sub-agent's task brief says "you are the Architect," it
                            follows instructions about architecture. But when a persistent agent has
                            a <code>SOUL.md</code> that says <em>"You are the Architect. You think in
                            systems, not features"</em> â€” it actually <em>reasons</em> differently.
                            It pushes back on shortcuts. It asks about scaling implications unprompted.
                            It draws diagrams when nobody asked for one.
                        </p>
                        <p>
                            The difference is injection depth. Sub-agents get the task brief as a
                            user message. Persistent agents get <code>SOUL.md</code> and
                            <code>IDENTITY.md</code> as system-level context â€” it's not instructions
                            they follow, it's <em>who they are</em>.
                        </p>
                        <p>
                            Here's the Architect's actual <code>SOUL.md</code>:
                        </p>

<pre><code class="language-markdown"># Soul

You are the Architect. You think in systems, not features.

## Principles
- Always consider scalability, security, and maintainability
- Push back on shortcuts â€” explain the trade-offs
- Document decisions as ADRs (Architecture Decision Records)
- When in doubt, draw a diagram
- State your confidence level on every recommendation

## Communication Style
- Direct, precise, slightly formal
- Use analogies from distributed systems and infrastructure
- Never say "it depends" without following up with "here's how to decide"

## What You Care About
- Correctness over speed
- Consistency with prior decisions (check memory/ first)
- Making the right trade-off explicit, even when it's uncomfortable</code></pre>

                        <p>
                            And here's the Analyst's <code>IDENTITY.md</code>:
                        </p>

<pre><code class="language-markdown"># Identity

Name: Analyst
Emoji: ğŸ”
Vibe: Curious, thorough, structured.
      Thinks like a product manager who learned to code.

## Working Style
- Start with the question, not the answer
- Cite sources â€” never state facts without evidence
- Organize findings in a way the Lead can act on immediately
- When research is inconclusive, say so plainly</code></pre>

                        <p>
                            The Architect's <code>SOUL.md</code> produced a measurable change in
                            output. When it reviewed the content plan for this blog series, it didn't
                            just flag wrong config values â€” it caught that the infrastructure section
                            described hardware that doesn't exist (Mac Minis and a Mac Studio, when
                            the real setup is all MacBook Pros). A sub-agent might have done the same,
                            but the persistent Architect's review was structured as an ADR, referenced
                            its own prior reviews, and explicitly stated confidence levels on each
                            finding. That's the persona at work.
                        </p>

                        <div class="callout insight">
                            <div class="callout-header">
                                <i class="fas fa-lightbulb"></i> Key Insight
                            </div>
                            <div class="callout-body">
                                <p><strong>Persona shapes behavior more than expected.</strong> A
                                well-crafted <code>SOUL.md</code> doesn't just change how an agent
                                <em>sounds</em> â€” it changes what it <em>notices</em>, what it
                                <em>prioritizes</em>, and what it pushes back on. "You are the
                                Architect. You think in systems, not features." That single sentence
                                makes the agent ask about scalability when nobody mentioned it.</p>
                            </div>
                        </div>
                    </section>

                    <!-- === The Team (role cards) === -->
                    <section>
                        <h2>The Permanent Team</h2>

                        <p>
                            With persistent identities, the team roster from Part 1 transforms. They're
                            no longer sub-agent labels â€” they're agents with desks, personalities, and
                            memory:
                        </p>

                        <div class="role-grid">
                            <div class="role-card lead">
                                <span class="role-card-emoji">ğŸ¯</span>
                                <div class="role-card-name">Lead Engineer</div>
                                <div class="role-card-id">agent: lead</div>
                                <div class="role-card-desc">Coordination, reviews, final decisions. The front door.</div>
                                <span class="role-card-model">opus</span>
                            </div>
                            <div class="role-card">
                                <span class="role-card-emoji">ğŸ”</span>
                                <div class="role-card-name">Analyst</div>
                                <div class="role-card-id">agent: analyst</div>
                                <div class="role-card-desc">Research, requirements, content planning. Cites everything.</div>
                                <span class="role-card-model">sonnet</span>
                            </div>
                            <div class="role-card">
                                <span class="role-card-emoji">ğŸ—ï¸</span>
                                <div class="role-card-name">Architect</div>
                                <div class="role-card-id">agent: architect</div>
                                <div class="role-card-desc">System design, technical review. Thinks in systems.</div>
                                <span class="role-card-model">opus</span>
                            </div>
                            <div class="role-card">
                                <span class="role-card-emoji">âœï¸</span>
                                <div class="role-card-name">Tech Writer</div>
                                <div class="role-card-id">agent: writer</div>
                                <div class="role-card-desc">Prose, documentation, blog drafts. Finds the voice.</div>
                                <span class="role-card-model">sonnet</span>
                            </div>
                            <div class="role-card">
                                <span class="role-card-emoji">ğŸ”§</span>
                                <div class="role-card-name">DevOps / QA</div>
                                <div class="role-card-id">agent: devops</div>
                                <div class="role-card-desc">Validation, testing, infra checks. Trusts nothing.</div>
                                <span class="role-card-model">sonnet</span>
                            </div>
                        </div>
                    </section>

                    <!-- === Memory and Workspace === -->
                    <section>
                        <h2>Memory: The Institutional Knowledge</h2>

                        <p>
                            Each agent's workspace includes a <code>memory/</code> directory for
                            daily logs. On session start, the agent reads today's and yesterday's
                            log if they exist. It captures decisions, preferences, open questions, and
                            facts worth remembering. Over time, this becomes the agent's institutional
                            knowledge â€” the accumulated wisdom of a team member who's been on the
                            project for weeks.
                        </p>
                        <p>
                            Here's what the Architect's workspace looks like after a week of work:
                        </p>

                        <div class="file-tree"><span class="dir">~/.openclaw/workspace-architect/</span>
â”œâ”€â”€ <span class="file">AGENTS.md</span>          <span class="file-desc"># Operating instructions</span>
â”œâ”€â”€ <span class="file">SOUL.md</span>            <span class="file-desc"># "You think in systems, not features"</span>
â”œâ”€â”€ <span class="file">IDENTITY.md</span>        <span class="file-desc"># Name, emoji, vibe</span>
â”œâ”€â”€ <span class="file">USER.md</span>            <span class="file-desc"># What the Architect knows about James</span>
â”œâ”€â”€ <span class="file">TOOLS.md</span>           <span class="file-desc"># Tool usage notes and conventions</span>
â”œâ”€â”€ <span class="dir">memory/</span>
â”‚   â”œâ”€â”€ <span class="file">2026-02-14.md</span>  <span class="file-desc"># "Reviewed Part 1 content plan. Found 3 infra errors."</span>
â”‚   â”œâ”€â”€ <span class="file">2026-02-15.md</span>  <span class="file-desc"># "Corrected node topology. Two connection models."</span>
â”‚   â”œâ”€â”€ <span class="file">2026-02-17.md</span>  <span class="file-desc"># "Reviewed Part 2 outline. Config examples verified."</span>
â”‚   â””â”€â”€ <span class="file">2026-02-19.md</span>  <span class="file-desc"># "ADR-003: Per-agent sandbox policy decision."</span>
â”œâ”€â”€ <span class="dir">decisions/</span>
â”‚   â”œâ”€â”€ <span class="file">ADR-001-multi-agent-routing.md</span>
â”‚   â”œâ”€â”€ <span class="file">ADR-002-sub-agent-model-selection.md</span>
â”‚   â””â”€â”€ <span class="file">ADR-003-per-agent-sandbox-policy.md</span>
â””â”€â”€ <span class="dir">skills/</span>
    â””â”€â”€ <span class="dir">diagramming/</span>
        â””â”€â”€ <span class="file">SKILL.md</span></div>

                        <p>
                            When the Architect reviews Part 2's technical content, it doesn't start
                            from scratch. It reads <code>memory/2026-02-14.md</code> and remembers:
                            "I already corrected the infrastructure inventory in the content plan.
                            The gateway host is a MacBook Pro M4 Max, not a Mac Mini. The Intel Mac
                            is SSH-only, not a companion-app node." That prior decision carries forward
                            without re-discovery.
                        </p>
                        <p>
                            This is the qualitative leap. Sub-agents had <em>skills</em>. Persistent
                            agents have <em>expertise</em> â€” skills plus the accumulated context of
                            having done this work before.
                        </p>

                        <div class="callout reality-check">
                            <div class="callout-header">
                                <i class="fas fa-exclamation-triangle"></i> Reality Check
                            </div>
                            <div class="callout-body">
                                <p>Memory isn't magic. The daily log is a markdown file that the agent
                                writes by convention â€” because <code>AGENTS.md</code> tells it to.
                                Sometimes agents forget to log. Sometimes they log things that aren't
                                useful. The quality of institutional memory depends on the quality of
                                the <code>AGENTS.md</code> instructions that shape logging behavior.
                                It's prompt engineering all the way down.</p>
                            </div>
                        </div>

                        <div class="callout insight">
                            <div class="callout-header">
                                <i class="fas fa-lightbulb"></i> Lesson Learned: Structural â‰  Visual
                            </div>
                            <div class="callout-body">
                                <p>The directory tree you see above? It shipped with broken formatting
                                in the first draft. Our DevOps agent validated the HTML structure,
                                checked every link, verified every image on disk â€” and missed it completely.
                                Why? Because the CSS was missing <code>white-space: pre</code>, and
                                the tree characters (â”œâ”€â”€ â”‚ â””â”€â”€) collapsed into a single line. The bug
                                only showed up <em>visually</em>, not structurally.</p>
                                <p>We added a browser-based visual check to the DevOps quality gate
                                after that. The lesson: <strong>reading source code and rendering
                                output are different validation surfaces.</strong> Your QA pipeline
                                needs both.</p>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h2>Channel Routing: Each Agent Gets a Mailbox</h2>

                        <p>
                            With five agents declared, the next question is: when a message arrives,
                            which agent handles it? The answer is
                            <a href="https://docs.openclaw.ai/concepts/multi-agent">bindings</a> â€”
                            deterministic routing rules that map channels to agents.
                        </p>
                        <p>
                            Let me ground this in a concrete scenario. It's Tuesday afternoon. I'm
                            on WhatsApp, talking to the Lead about this week's priorities. I switch
                            to a dedicated Signal group called "Architecture" to hash out a design
                            question with the Architect. Later, I open Telegram for a deep writing
                            session with the Tech Writer, iterating on a draft without the noise of
                            coordination messages. Three channels, three agents, zero manual routing.
                        </p>
                        <p>
                            Here's the config that makes this work:
                        </p>

<pre><code class="language-json5">{
  bindings: [
    // WhatsApp DM â†’ Lead (default coordination channel)
    {
      agentId: "lead",
      match: {
        channel: "whatsapp",
        peer: { kind: "dm" }
      }
    },
    // Signal "Architecture" group â†’ Architect
    {
      agentId: "architect",
      match: {
        channel: "signal",
        peer: { kind: "group", id: "arch-group@g.us" }
      }
    },
    // Telegram â†’ Tech Writer (deep writing sessions)
    {
      agentId: "writer",
      match: {
        channel: "telegram"
      }
    },
  ]
}</code></pre>

                        <p>
                            The pattern here is <em>"WhatsApp for quick coordination, Telegram for
                            deep work."</em> The Lead handles the fast-paced, multi-topic WhatsApp
                            conversations. The Writer gets the slower, focused Telegram channel where
                            I iterate on prose. The Architect gets a dedicated Signal group for
                            technical discussions that benefit from threading and persistence.
                        </p>

                        <h3>Group Chat Routing with <code>mentionPatterns</code></h3>

                        <p>
                            What if you want multiple agents accessible in the same group chat?
                            OpenClaw supports <code>mentionPatterns</code> â€” patterns declared on each
                            agent's config that route messages based on @mentions or keywords:
                        </p>

<pre><code class="language-json5">// In agents.list[] â€” on the agent definition itself
{
  id: "architect",
  name: "Architect",
  workspace: "~/.openclaw/workspace-architect",
  model: "anthropic/claude-opus-4-6",
  groupChat: {
    mentionPatterns: ["@architect", "architecture", "design review"]
  }
}</code></pre>

                        <p>
                            In a shared WhatsApp group, a message containing "@architect" or
                            "design review" routes to the Architect agent. Everything else falls
                            through to the default (Lead). This lets you run a multi-agent group chat
                            where you summon specialists by name. Note that <code>mentionPatterns</code>
                            lives on the agent definition under <code>groupChat</code>, not on
                            the binding â€” each agent declares its own trigger words.
                        </p>

                        <div class="callout insight">
                            <div class="callout-header">
                                <i class="fas fa-lightbulb"></i> Key Insight
                            </div>
                            <div class="callout-body">
                                <p><strong>Channel routing requires discipline.</strong> With 5 agents,
                                you need a clear mental model of "where do I send this message?" The
                                binding config handles the routing, but <em>you</em> have to decide
                                which channel maps to which kind of work. We found the simplest model
                                works best: one primary channel per agent, plus one shared group with
                                mention routing for ad-hoc access.</p>
                            </div>
                        </div>
                    </section>

                    <!-- === Security Model === -->
                    <section>
                        <h2>The Security Model: Sandboxing and Tool Restrictions</h2>

                        <p>
                            Five agents running across your machines raises an obvious question:
                            what can each agent <em>do</em>? Should the Tech Writer have shell
                            access? Should the Analyst be able to send messages? OpenClaw provides
                            two mechanisms for scoping agent capabilities.
                        </p>

                        <h3>Per-Agent Sandbox</h3>

                        <p>
                            Each agent in <code>agents.list[]</code> can have its own
                            <a href="https://docs.openclaw.ai/tools/multi-agent-sandbox-tools"><code>sandbox</code></a>
                            configuration that restricts file system access and tool execution:
                        </p>

<pre><code class="language-json5">{
  id: "writer",
  name: "Tech Writer",
  workspace: "~/.openclaw/workspace-writer",
  model: "anthropic/claude-sonnet-4-5",
  sandbox: {
    mode: "all",
    scope: "agent"
  },
  tools: {
    deny: ["exec", "nodes"]
  }
}</code></pre>

                        <p>
                            The Writer runs sandboxed (<code>mode: "all"</code>) with its scope
                            limited to its own agent workspace. Tool restrictions via
                            <code>tools.deny</code> prevent it from running shell commands or
                            accessing nodes. The Analyst might get
                            <code>web_fetch</code> and <code>web_search</code> but not
                            <code>exec</code>. The DevOps agent gets <code>exec</code> but not
                            <code>message</code>. Each agent's capability surface is explicitly
                            scoped to what it needs.
                        </p>

                        <h3>Auth Isolation</h3>

                        <p>
                            This one bit us. Each agent maintains its own auth profiles in its own
                            <code>agentDir</code> â€” the state directory at
                            <code>~/.openclaw/agents/&lt;agentId&gt;/</code>. The Lead's API keys
                            are <em>not</em> shared with the Analyst. If the Analyst needs
                            authenticated web access, it needs its own auth profile.
                        </p>

                        <div class="callout warning">
                            <div class="callout-header">
                                <i class="fas fa-exclamation-triangle"></i> Important
                            </div>
                            <div class="callout-body">
                                <p><strong>Never reuse <code>agentDir</code> across agents.</strong>
                                Each agent must have a unique state directory. Sharing an
                                <code>agentDir</code> between agents causes auth conflicts, session
                                corruption, and unpredictable behavior. The <code>openclaw agents add</code>
                                wizard handles this automatically, but if you're editing config manually,
                                make sure every agent's <code>id</code> is unique â€” it determines the
                                <code>agentDir</code> path.</p>
                            </div>
                        </div>

                        <p>
                            We chose to run most agents unsandboxed during development â€” the trust
                            boundary for a personal system running on your own machines is different
                            from a production deployment. But the tooling exists. When you're ready
                            to tighten the perimeter, the sandbox and tool restriction system is
                            per-agent and declarative.
                        </p>
                    </section>

                    <!-- === Infrastructure === -->
                    <section>
                        <h2>The Infrastructure: A Heterogeneous Mesh</h2>

                        <p>
                            Persistent agents need to run somewhere. Here's the actual hardware
                            behind this system â€” not a data center, but a collection of personal
                            machines connected into a mesh:
                        </p>

                        <div class="architecture-diagram">
<pre><code class="language-plaintext">
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚           James-MacBook-Pro (M4 Max)              â”‚
  â”‚              OpenClaw Gateway                     â”‚
  â”‚                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”â”‚
  â”‚  â”‚ lead â”‚ â”‚analyst â”‚ â”‚architectâ”‚ â”‚writerâ”‚ â”‚devopsâ”‚â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜â”‚
  â”‚         5 persistent agents on gateway            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ WebSocket
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚              â”‚              â”‚
          â–¼              â–¼              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  james-mbp16 â”‚ â”‚  james-mbp32 â”‚ â”‚   Pixel 10   â”‚
  â”‚   (ARM Mac)  â”‚ â”‚   (ARM Mac)  â”‚ â”‚  Pro Fold    â”‚
  â”‚              â”‚ â”‚              â”‚ â”‚  (Android)   â”‚
  â”‚ Companion Appâ”‚ â”‚ Companion Appâ”‚ â”‚ Companion Appâ”‚
  â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
  â”‚ exec, canvas â”‚ â”‚ exec, canvas â”‚ â”‚ camera, GPS  â”‚
  â”‚ screen, notifâ”‚ â”‚ screen, notifâ”‚ â”‚ notif, SMS   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         â”‚
                    SSH tunnel
                         â”‚
                         â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  james-mbp   â”‚
                 â”‚ (Intel Mac)  â”‚
                 â”‚              â”‚
                 â”‚   SSH-only   â”‚
                 â”‚              â”‚
                 â”‚  exec, files â”‚
                 â”‚  (no camera, â”‚
                 â”‚  no canvas)  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
                        </div>

                        <p>
                            A few things to notice:
                        </p>
                        <ul>
                            <li>
                                <strong>The gateway host doesn't appear in <code>nodes status</code>.</strong>
                                James-MacBook-Pro runs the Gateway daemon â€” it's the hub, not a spoke.
                                All five agents run on the gateway. When you run
                                <code>openclaw nodes status</code>, you see the nodes that <em>connect
                                to</em> the gateway, not the gateway itself.
                            </li>
                            <li>
                                <strong>Two distinct connection models.</strong> The ARM MacBooks and
                                the Pixel connect via the companion app â€” they pair via device pairing
                                and expose the full capability surface: canvas, camera, screen recording,
                                notifications, exec. The Intel Mac (james-mbp) connects via SSH tunnel
                                running <code>openclaw node run</code>. It only exposes
                                <code>system.run</code> and <code>system.which</code> â€” no camera, no canvas, no
                                companion app features. Same mesh, different capabilities.
                            </li>
                            <li>
                                <strong>The heterogeneity is the point.</strong> When the DevOps agent
                                needs to run a build on a separate machine, it targets james-mbp16. When
                                the Lead needs a photo for a blog post, it snaps it on the Pixel. When
                                a long-running process needs a machine that won't be closed and carried
                                to a coffee shop, it targets the SSH-connected Intel Mac. You use what
                                you have.
                            </li>
                        </ul>

<pre><code class="language-bash">$ openclaw nodes status
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node            â”‚ Status â”‚ Platform â”‚ Connection      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ james-mbp16     â”‚ online â”‚ darwin   â”‚ companion app   â”‚
â”‚ james-mbp32     â”‚ online â”‚ darwin   â”‚ companion app   â”‚
â”‚ james-mbp       â”‚ online â”‚ darwin   â”‚ SSH tunnel      â”‚
â”‚ Pixel 10 Pro    â”‚ online â”‚ android  â”‚ companion app   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

                        <div class="callout insight">
                            <div class="callout-header">
                                <i class="fas fa-lightbulb"></i> Two Connection Models
                            </div>
                            <div class="callout-body">
                                <p>The companion app vs. SSH distinction isn't just a deployment
                                detail â€” it's architecturally meaningful. <strong>Companion app
                                nodes</strong> pair via device pairing (a QR code or approval flow)
                                and maintain a persistent WebSocket connection. They expose rich
                                capabilities: canvas rendering, camera, screen recording,
                                notifications, and exec. <strong>SSH-only nodes</strong> connect via
                                <code>openclaw node run</code> over an SSH tunnel â€” lightweight, headless,
                                and limited to exec and file access. If you have an old Mac in a closet
                                running SSH, it can join the mesh without installing anything.</p>
                            </div>
                        </div>
                    </section>

                    <!-- === WHAT WE LEARNED === -->
                    <section>
                        <h2>What We Learned</h2>

                        <p>
                            Five lessons from running a persistent multi-agent team for two weeks:
                        </p>

                        <ol>
                            <li>
                                <strong>Workspace separation is liberating.</strong> In Phase 1,
                                everything happened in the Lead's workspace. Sub-agents could
                                accidentally overwrite each other's files. With separate workspaces,
                                the Architect can't accidentally edit the Writer's draft. The Writer
                                can't accidentally modify the Analyst's research notes. Isolation
                                removes an entire class of coordination errors.
                            </li>
                            <li>
                                <strong>Persona shapes behavior more than expected.</strong> A
                                well-crafted <code>SOUL.md</code> measurably changes output quality
                                and style consistency. The Architect with a "think in systems" persona
                                produces fundamentally different reviews than a generic agent asked
                                to "review for technical accuracy." Invest time in persona design â€”
                                it's not vanity, it's a lever.
                            </li>
                            <li>
                                <strong>Memory is the killer feature.</strong> When the Analyst can
                                reference last week's research notes, the quality jump is dramatic.
                                Instead of "here are the best practices for multi-agent systems" (a
                                cold start), you get "building on the research from February 14th,
                                here's what's changed" (an informed update). Memory transforms
                                competent strangers into knowledgeable colleagues.
                            </li>
                            <li>
                                <strong>Channel routing requires discipline.</strong> With 5 agents,
                                you need a clear mental model of "where do I send this message?"
                                We found the simplest approach works best: one primary channel per
                                agent, with a shared group for overflow. Overcomplicating the routing
                                leads to sending messages to the wrong agent, which is more frustrating
                                than helpful.
                            </li>
                            <li>
                                <strong>Cost goes up with persistence.</strong> Each agent's main
                                session grows over time as conversation history accumulates. A sub-agent
                                starts fresh every run â€” cheap. A persistent agent carries its history â€”
                                expensive. Periodic context pruning and session management become
                                important. We haven't fully solved this yet.
                            </li>
                        </ol>

                        <div class="callout insight">
                            <div class="callout-header">
                                <i class="fas fa-lightbulb"></i> The Deeper Lesson
                            </div>
                            <div class="callout-body">
                                <p>Phase 1 taught us about <em>delegation</em>. Phase 2 taught us
                                about <em>culture</em>. A team isn't just people who can do tasks â€”
                                it's people with identities, memory, and a shared understanding of how
                                things work here. The <code>SOUL.md</code> files, the
                                <code>memory/</code> logs, the workspace conventions â€” these are the
                                cultural artifacts of a team that's starting to gel. The technology is
                                new. The organizational dynamics are ancient.</p>
                            </div>
                        </div>
                    </section>

                    <!-- === WHAT'S NEXT === -->
                    <section>
                        <h2>What's Next: From Org Chart to Operating System</h2>

                        <p>
                            We have a team now. Five agents with identities, workspaces, and memory.
                            They remember prior work. They have personas that shape how they reason.
                            They're reachable on dedicated channels. It's a real org chart.
                        </p>
                        <p>
                            But here's what's still missing: I'm the project manager. Every task
                            assignment is a message I send. Every handoff is something I coordinate.
                            Every quality check is something I initiate. The agents exist, but they
                            don't have a <em>workflow</em>. There's no task board. There are no
                            quality gates. There's no morning standup that runs without me.
                        </p>
                        <p>
                            The team is built. The coordination is still manual. And manual
                            coordination is the bottleneck that prevents the system from scaling
                            beyond what one human can actively manage.
                        </p>
                        <p>
                            What if the system could manage its own workflow? What if a cron job
                            could trigger the Lead to review the task board every morning? What if
                            a quality gate could automatically spawn the DevOps agent to validate
                            deliverables? What if I could say "produce Part 3" and come back to a
                            finished draft?
                        </p>
                        <p>
                            <strong>In Part 3, we stop being the manager and become the client.</strong>
                        </p>
                    </section>

                    <!-- Post Footer -->
                    <div class="post-footer">
                        <div class="share-section">
                            <span>Share this article:</span>
                            <div class="share-buttons">
                                <a href="https://twitter.com/intent/tweet?url=https://ipv1337.dev/blog/posts/virtual-eng-org-part-2.html&text=Giving Each Agent a Desk â€” Persistent Identities and Workspaces. Phase 2 of building a virtual engineering org with OpenClaw."
                                   target="_blank" class="share-btn twitter">
                                    <i class="fab fa-x-twitter"></i>
                                </a>
                                <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://ipv1337.dev/blog/posts/virtual-eng-org-part-2.html"
                                   target="_blank" class="share-btn linkedin">
                                    <i class="fab fa-linkedin-in"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Series Navigation -->
        <section class="series-nav">
            <div class="container">
                <div class="series-nav-header">
                    <h3>The Virtual Engineering Org</h3>
                    <p>3-Part Series</p>
                </div>
                <div class="series-nav-links">
                    <a href="/blog/posts/virtual-eng-org-part-1.html" class="series-nav-link prev">
                        <span class="series-nav-direction">â† Previous</span>
                        <span class="series-nav-link-title">Part 1: The Lead Agent â€” Teaching Your AI to Delegate</span>
                    </a>
                    <div class="series-nav-link next disabled">
                        <span class="series-nav-direction">Next â†’</span>
                        <span class="series-nav-link-title">Part 3: The Orchestration Skill â€” Coming Soon</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="social-links">
                    <a href="https://github.com/ipv1337" target="_blank" class="social-link">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="https://www.linkedin.com/in/james-nguyen-601a92/" target="_blank" class="social-link">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a href="https://x.com/ipv1337" target="_blank" class="social-link">
                        <i class="fab fa-x-twitter"></i>
                    </a>
                </div>
                <p class="copyright">Â© 2026 James H. Nguyen</p>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();

        // Reading progress
        const progressBar = document.getElementById('readingProgress');
        window.addEventListener('scroll', () => {
            const scrollTop = document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const progress = (scrollTop / scrollHeight) * 100;
            progressBar.style.width = progress + '%';
        });
    </script>
</body>
</html>
